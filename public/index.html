<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Multiplayer Game</title>
    <style>
        body, html { margin: 0; padding: 0; font-family: sans-serif; height: 100%; background: transparent; }
        
        /* Center everything */
        .screen { display: none; padding: 20px; box-sizing: border-box; flex-direction: column; align-items: center; }
        .active { display: flex; }

        /* Card Styling */
        .card { background: white; width: 100%; max-width: 400px; padding: 20px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); border: 1px solid #ddd; }
        
        /* Headers */
        .header-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        h2 { margin: 0; font-size: 20px; }

        /* Buttons & Inputs */
        button { width: 100%; padding: 12px; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; margin-top: 10px; }
        .btn-primary { background: #0070f3; color: white; }
        .btn-exit { background: #ff4d4f; color: white; width: auto; padding: 5px 15px; font-size: 14px; }
        
        input { width: 90%; padding: 10px; border: 1px solid #ccc; border-radius: 8px; margin-bottom: 10px; box-sizing: border-box; }
        ul { list-style: none; padding: 0; }
        li { padding: 10px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }

        /* UTILITY: Hide things based on mode */
        .hidden-section { display: none !important; }
    </style>
</head>
<body>

    <div id="lobbyScreen" class="screen active">
        <div class="card">
            <h2 style="text-align:center; margin-bottom:15px;">ðŸŽ® Game Hub</h2>
            
            <div id="hostSection">
                <hr>
                <p style="font-weight:bold; margin-bottom:5px;">Create a Room</p>
                <input type="text" id="gameName" placeholder="Enter Room Name...">
                <button class="btn-primary" onclick="hostGame()">Host Game</button>
                <br><br>
            </div>

            <div id="joinSection">
                <hr>
                <p style="font-weight:bold; margin-bottom:5px;">Join a Room</p>
                <ul id="gameList">
                    <li style="color:#888;">Searching for games...</li>
                </ul>
            </div>
        </div>
    </div>

    <div id="roomScreen" class="screen">
        <div class="card">
            <div class="header-row">
                <h2 id="roomTitle">Room Name</h2>
                <button class="btn-exit" onclick="leaveGame()">EXIT</button>
            </div>
            
            <p>Room ID: <b id="roomCode">...</b></p>
            <hr>
            
            <h3>Players:</h3>
            <ul id="playerList"></ul>
            <p id="status" style="color:#888; margin-top:20px;">Waiting...</p>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let currentRoomId = null;

        // --- 1. THE MODE DETECTOR (The New Part) ---
        window.onload = function() {
            const params = new URLSearchParams(window.location.search);
            const mode = params.get('mode');

            if (mode === 'host') {
                // If Host Mode: Hide the Join Section
                document.getElementById('joinSection').classList.add('hidden-section');
            } else if (mode === 'join') {
                // If Join Mode: Hide the Host Section
                document.getElementById('hostSection').classList.add('hidden-section');
            }
            // If no mode is found, it shows both (default)
        };

        // --- 2. GAME ACTIONS ---
        function hostGame() {
            const name = document.getElementById('gameName').value;
            if(name) socket.emit('hostGame', name);
        }
        function joinGame(id) { socket.emit('joinGame', id); }
        function leaveGame() { 
            if(currentRoomId) socket.emit('leaveGame', currentRoomId); 
        }

        // --- 3. SOCKET LISTENERS ---
        socket.on('updateGameList', (games) => {
            const list = document.getElementById('gameList');
            list.innerHTML = '';
            const gArray = Object.values(games);
            
            if(gArray.length === 0) {
                list.innerHTML = '<li style="color:#888;">No active games found.</li>';
                return;
            }

            gArray.forEach(g => {
                list.innerHTML += `<li><span><b>${g.name}</b></span> <button class="btn-primary" style="width:auto; padding:5px 10px; margin:0;" onclick="joinGame('${g.id}')">Join</button></li>`;
            });
        });

        socket.on('joinedRoom', (room) => {
            currentRoomId = room.id;
            document.getElementById('lobbyScreen').classList.remove('active');
            document.getElementById('roomScreen').classList.add('active');
            document.getElementById('roomTitle').innerText = room.name;
            document.getElementById('roomCode').innerText = room.id;
            updatePlayers(room.players);
        });

        socket.on('playerUpdate', updatePlayers);
        
        socket.on('backToLobby', () => {
            currentRoomId = null;
            document.getElementById('roomScreen').classList.remove('active');
            document.getElementById('lobbyScreen').classList.add('active');
        });

        function updatePlayers(players) {
            document.getElementById('playerList').innerHTML = players.map(p => `<li>ðŸ‘¤ Player ${p}</li>`).join('');
            document.getElementById('status').innerText = players.length > 1 ? "Ready!" : "Waiting for opponent...";
        }
    </script>
</body>
</html>
